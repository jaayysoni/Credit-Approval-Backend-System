<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Credit Approval System</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 p-6">
  <h1 class="text-3xl font-bold text-center mb-8">Credit Approval System</h1>

  <!-- Register Customer -->
  <div class="bg-white shadow-md rounded p-6 mb-8 max-w-xl mx-auto">
    <h2 class="text-xl font-semibold mb-4">Register Customer</h2>
    <form id="registerForm" class="space-y-4">
      <input type="text" name="first_name" placeholder="First Name" class="border p-2 w-full" required>
      <input type="text" name="last_name" placeholder="Last Name" class="border p-2 w-full" required>
      <input type="number" name="age" placeholder="Age" class="border p-2 w-full" required>
      <input type="number" name="monthly_income" placeholder="Monthly Income" class="border p-2 w-full" required>
      <input type="text" name="phone_number" placeholder="Phone Number" class="border p-2 w-full" required>
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded w-full">Register</button>
    </form>
    <pre id="registerResponse" class="bg-gray-100 p-4 rounded text-sm mt-4"></pre>
  </div>

  <!-- Check Eligibility -->
  <div class="bg-white shadow-md rounded p-6 mb-8 max-w-xl mx-auto">
    <h2 class="text-xl font-semibold mb-4">Check Eligibility</h2>
    <form id="eligibilityForm" class="space-y-4">
      <input type="number" name="customer_id" placeholder="Customer ID" class="border p-2 w-full" required>
      <input type="number" name="loan_amount" placeholder="Loan Amount" class="border p-2 w-full" required>
      <input type="number" name="interest_rate" placeholder="Interest Rate (%)" class="border p-2 w-full" required>
      <input type="number" name="tenure" placeholder="Tenure (months)" class="border p-2 w-full" required>
      <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded w-full">Check</button>
    </form>
    <pre id="eligibilityResponse" class="bg-gray-100 p-4 rounded text-sm mt-4"></pre>
  </div>

  <!-- Create Loan -->
  <div class="bg-white shadow-md rounded p-6 mb-8 max-w-xl mx-auto">
    <h2 class="text-xl font-semibold mb-4">Create Loan</h2>
    <form id="createLoanForm" class="space-y-4">
      <input type="number" name="customer_id" placeholder="Customer ID" class="border p-2 w-full" required>
      <input type="number" name="loan_amount" placeholder="Loan Amount" class="border p-2 w-full" required>
      <input type="number" name="interest_rate" placeholder="Interest Rate (%)" class="border p-2 w-full" required>
      <input type="number" name="tenure" placeholder="Tenure (months)" class="border p-2 w-full" required>
      <button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded w-full">Create</button>
    </form>
    <pre id="createLoanResponse" class="bg-gray-100 p-4 rounded text-sm mt-4"></pre>
  </div>

  <!-- View Loan -->
  <div class="bg-white shadow-md rounded p-6 mb-8 max-w-xl mx-auto">
    <h2 class="text-xl font-semibold mb-4">View Loan</h2>
    <form id="viewLoanForm" class="space-y-4">
      <input type="number" name="loan_id" placeholder="Loan ID" class="border p-2 w-full" required>
      <button type="submit" class="bg-yellow-600 text-white px-4 py-2 rounded w-full">View Loan</button>
    </form>
    <pre id="viewLoanResponse" class="bg-gray-100 p-4 rounded text-sm mt-4"></pre>
  </div>

  <!-- View Loans by Customer -->
  <div class="bg-white shadow-md rounded p-6 mb-8 max-w-xl mx-auto">
    <h2 class="text-xl font-semibold mb-4">View Loans by Customer</h2>
    <form id="viewCustomerLoansForm" class="space-y-4">
      <input type="number" name="customer_id" placeholder="Customer ID" class="border p-2 w-full" required>
      <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded w-full">View Loans</button>
    </form>
    <pre id="viewCustomerLoansResponse" class="bg-gray-100 p-4 rounded text-sm mt-4"></pre>
  </div>

<script>

// Convert form data to JSON properly
function formToJSON(form) {
  const data = {};
  const formData = new FormData(form);

  formData.forEach((value, key) => {
    // Convert numeric fields to numbers
    if (!isNaN(value) && value !== "") {
      data[key] = Number(value);
    } else {
      data[key] = value;
    }
  });

  return data;
}

async function postRequest(formId, url, responseId) {
  const form = document.getElementById(formId);
  const responseBox = document.getElementById(responseId);

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const jsonData = formToJSON(form);

    try {
      const res = await fetch(url, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(jsonData)
      });

      const data = await res.json();
      responseBox.textContent = JSON.stringify(data, null, 2);
    } catch (error) {
      responseBox.textContent = "Error: " + error.message;
    }
  });
}

async function getRequest(formId, urlTemplate, responseId) {
  const form = document.getElementById(formId);
  const responseBox = document.getElementById(responseId);

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const idValue = form.querySelector("input").value;
    const url = urlTemplate.replace("ID", idValue);

    try {
      const res = await fetch(url);
      const data = await res.json();
      responseBox.textContent = JSON.stringify(data, null, 2);
    } catch (error) {
      responseBox.textContent = "Error: " + error.message;
    }
  });
}

// API Calls
postRequest("registerForm", "http://127.0.0.1:8000/api/register/", "registerResponse");
postRequest("eligibilityForm", "http://127.0.0.1:8000/eligibility/", "eligibilityResponse");
postRequest("createLoanForm", "http://127.0.0.1:8000/create-loan/", "createLoanResponse");

getRequest("viewLoanForm", "http://127.0.0.1:8000/loan/ID/", "viewLoanResponse");
getRequest("viewCustomerLoansForm", "http://127.0.0.1:8000/customer/ID/loans/", "viewCustomerLoansResponse");

</script>

</body>
</html>